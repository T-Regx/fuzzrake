<DirectoryMatch "^/var/www/[^/]+/public">
    Require all granted

    <IfModule headers_module>
        Header always set X-Frame-Options DENY
    </IfModule>

    <IfModule deflate_module>
        <IfModule !brotli_module>
            SetOutputFilter DEFLATE
            SetEnvIfNoCase Request_URI "\.(?:gif|jpe?g|png)$" no-gzip
        </IfModule>
    </IfModule>

    <IfModule brotli_module>
      SetOutputFilter BROTLI
      SetEnvIfNoCase Request_URI "\.(?:gif|jpe?g|png)$" no-br
    </IfModule>

    <IfModule expires_module>
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        ExpiresByType text/html M0
    </IfModule>
</DirectoryMatch>

<VirtualHost *:80>
    ServerName getfursu.it
    DocumentRoot "/var/www/prod/public"

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
    </IfModule>
</VirtualHost>

<VirtualHost *:80>
    ServerName beta.getfursu.it
    DocumentRoot "/var/www/beta/public"
    ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9556/var/www/html/public/$1

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
    </IfModule>
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName getfursu.it
        DocumentRoot "/var/www/prod/public"

        <IfModule headers_module>
            Header always set Strict-Transport-Security "max-age=31536000; includeSubdomains;"
        </IfModule>

        Include /etc/letsencrypt/options-ssl-apache.conf
        SSLCertificateFile /etc/letsencrypt/live/getfursu.it/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/getfursu.it/privkey.pem
    </VirtualHost>

    <VirtualHost *:443>
        ServerName beta.getfursu.it
        DocumentRoot "/var/www/beta/public"
        ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9556/var/www/html/public/$1

        <IfModule headers_module>
            Header always set Strict-Transport-Security "max-age=31536000; includeSubdomains;"
        </IfModule>

        Include /etc/letsencrypt/options-ssl-apache.conf
        SSLCertificateFile /etc/letsencrypt/live/getfursu.it/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/getfursu.it/privkey.pem
    </VirtualHost>
</IfModule>
